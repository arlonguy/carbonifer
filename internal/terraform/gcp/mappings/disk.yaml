general:
  json_data:
    gcp_machines_types: "gcp_instances.json"

compute_resource:
  google_compute_disk:
    paths:
      - $.planned_values.root_module.resources[?(@.type=="google_compute_disk")]
      - $.planned_values.root_module.resources[?(@.type=="google_compute_region_disk")]
    type: resource
    properties:
      name:
        paths: "name"
      address:
        paths: "address"
      zone:
        - paths: "values.zone"
        - paths: "values.replica_zones[0]"
      region:
        - paths: "values.zone"
          regex:
            pattern: "^(.*)-.*$"
            group: 1
        - paths: "values.replica_zones[0]"
          regex:
            pattern: "^(.*)-.*$"
            group: 1
      replication_factor:
        - paths: "values.replica_zones.length()"
        - default: 1
      storage:
        type: list
        item:
          - paths: values
            size:
              - paths: "size"
                default: 10
                unit: gb
              - paths: "image"
                default: 10
                unit: gb
                reference:
                  paths: $.prior_state.values.root_module.resources[?(@.values.self_link=="${key}")].values
                  property: "disk_size_gb"
            type:
              paths: "type"
              reference:
                general: disk_types
